<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">

    <title>Document</title>
</head>
<style>
    html,body { height: 100%;margin: 0; padding: 0;}
    *{
        padding: 0;
        margin: 0;
    }
    .chat_commento{
        width: 98%;
        height: 99%;
        margin: auto;
        border-radius: 10px;
        border: 2px solid #0400ff;
    }
    .clearfix::after{
        content: "";
        display: block;
        clear: both;
        width: 0;
        height: 0;
        line-height: 0;
        visibility: hidden;
    }
    /* top */
    .chat_top{
        width: 100%;
        height: 6%;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        padding-left: 5%;
        font-size: 120%;
        line-height: 200%;
        box-sizing: border-box;
        font-weight: 90%;
        border-width: 0px;
    }
    .chat_exit{
        width: 10%;
        height: 5%;
        color: white;
        background-color: #f30202;
        text-align: center;
        border-radius: 5px;
        position: absolute;
        right: 2%;
        top: 1%;
        line-height: 5%;
    }
    /* middle */
    /* 左边 */
    .chat_middle{
        width: 100%;
        height: 69%;
        position: relative;
        box-sizing: border-box;
        overflow: auto;
        border-width: 0px;
    }
    .chat_left{
        width: 98%;
        height: 18%;
        margin-left: 2%;
    }
      /*无效 如需使用,修改background-color*/
    .chat_left_item_1{
        width: 100%;
        height: 18%;
        float: left;
        margin-left: 10px;
        margin-right: 10px;
        text-align: center;
        line-height: 18%;
        color: white;
        border-radius: 25px;
        font-size:62.5%;
    }
    .chat_left_item_2{
        width: 100%;
        height: 18%;
        float: left;
    }
    .chat_left_item_2 .chat_left_chat{
        float: left;
    }
    .chat_left_item_2 .chat_left_content{
        padding: 15px;
        display: inline-block;
        border-radius: 10px;
        border-top-left-radius: 0px;
        background-color: #82f0c6;
    }
    /* 右边 */
    .chat_right{
        width: 98%;
        height: 18%;
        margin-top:0;
        margin-right:2%;
    }
    /*无效 如需使用,修改background-color*/
    .chat_right_item_1{
        width: 100%;
        height: 18%;
        float: right;
        margin-left: 10px;
        margin-right: 10px;
        text-align: center;
        line-height: 18%;
        color: white;
        border-radius: 25px;
        font-size:62.5%;
    }
    .chat_right_item_2{
        width: 100%;
        height: 18%;
        float: right;
    }
    .chat_right_time{
        width: 100%;
        color:#0400ff;
        text-align: right;
    }
    .chat_right_content{
        float: right;
        padding: 15px;
        border-radius: 10px;
        border-top-right-radius: 0px;
        background-color: #4F7cff;
        color: white;
    }
    /* foot */
    .chat_foot{
        width: 100%;
        height: 23%;
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
        position: relative;
    }
    .chat_context{
        width: 100%;
        height: 100%;
        font-size: 120%;
        box-sizing: border-box;
        outline: none;
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
        border-width: 0px;
        padding: 16px;
    }
    .chat_commit{
        width: 10%;
        height: 6%;
        color: white;
        background-color: #0206f3;
        text-align: center;
        border-radius: 5px;
        position: absolute;
        right: 2%;
        bottom: 2%;
        line-height: 5%;
    }
    .chat_commit1{
        width: 10%;
        height: 6%;
        color: white;
        background-color: #0206f3;
        text-align: center;
        border-radius: 5px;
        position: absolute;
        right: 18%;
        bottom: 2%;
        line-height: 5%;
    }
    .chat_context{
        resize: none;
    }
    .chat_context::placeholder{
        color: black;
        font-weight: 500k;
    }
    .line{
        width: 99%;
        border-top: 0px;
        border-color: #0055ff;
        border-style: solid;
    }
</style>
<body>
    <!-- entry -->
    <div class="chat_commento">
        <!-- top -->
        <div class="chat_top">
           zxLOVE的聊天室
        </div>
        <button class="chat_exit" id="exitBtn">退出</button>
        <!-- line -->
        <div class="line"></div>
        <!-- middle -->
        <div class="chat_middle" id="chat_middle_item">
            
        </div>
        <!-- line -->
        <div class="line"></div>
        <!-- foot -->
        <div class="chat_foot">
            <!-- context -->
            <textarea class="chat_context" id="chat_context_item" cols="30" rows="10" placeholder="请输入"></textarea>
        </div>
        <button class="chat_commit" id="sendBtn">发送</button>
        <button class="chat_commit1" id="sendBtn1">发送1</button>
    </div>
    <script>
        // 成功发送
        var send_message=document.getElementById("chat_middle_item");
        var domBtm=document.getElementById("sendBtn");
        // 发送内容
        var message=document.getElementById("chat_context_item");
        domBtm.addEventListener("click",function(){
            var str=message.value;
            if(str === "")
            {
                alert("消息不能为空!");
                return;
            }
            var date=new Date();
            var year = date.getFullYear();
            var mouth = date.getMonth() + 1;
            var day = date.getDate();
            var hour = date.getHours();
            var mm = date.getMinutes();
            var sec = date.getSeconds();
            var time =  year + '-' + mouth + '-' + day + ' '+  hour + ':'+ mm + ':' + sec;
            var ans='<div class="chat_right_item_1 clearfix"></div>'+
                '<div class="chat_right_item_2">'+
                    '<div class="chat_right_time clearfix">'+time+" " + localStorage["name"] +'</div>'+
                    '<div class="chat_right_content clearfix">'+str+'</div>'
                    +'</div>';
            /*var ans='<div class="chat_left_item_1 clearfix">gdgdfg</div>'+
                '<div class="chat_left_item_2">'+
                    '<div class="chat_left_time clearfix">'+time+'</div>'+
                    '<div class="chat_left_content clearfix">'+str+'</div>'
                    +'</div>';*/
            var oLi=document.createElement("div");
            oLi.setAttribute("class","chat_right");
            //oLi.setAttribute("class","chat_left");
            oLi.innerHTML=ans;
            send_message.append(oLi);
            message.value="";

        //特定的post数据格式
        var postData = 'postType=3&userName=' + localStorage["name"] + '&chatDate=' +  time + '&chatRecord=' + str;
        //1、创建xhr的对象
        let xhr = new XMLHttpRequest();
        //2、调用open函数('请求类型','url')
        xhr.open('POST', "func.php",true);
        //3、设置 Content-Type属性（固定写法）
        xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");
        //4、调用send函数
        xhr.send(postData);
        //5、监听事件
        xhr.onreadystatechange = function () 
        {
            /*if (xhr.readyState === 4 && xhr.status === 200)
            {
                if(xhr.responseText == 5)
                {
                    alert("聊天记录保存成功！");
                }
            }*/
        }
        });
    </script>

<script>
    // 成功发送
    var send_message=document.getElementById("chat_middle_item");
    var domBtm=document.getElementById("sendBtn1");
    // 发送内容
    var message=document.getElementById("chat_context_item");
    domBtm.addEventListener("click",function(){
        var str=message.value;
        if(str === "")
        {
            alert("消息不能为空!");
            return;
        }
        var date=new Date();
        var year = date.getFullYear();
        var mouth = date.getMonth() + 1;
        var day = date.getDate();
        var hour = date.getHours();
        var mm = date.getMinutes();
        var sec = date.getSeconds();
        var time =  year + '-' + mouth + '-' + day + ' '+  hour + ':'+ mm + ':' + sec;
    
        var ans='<div class="chat_left_item_1 clearfix"></div>'+
            '<div class="chat_left_item_2">'+
                '<div class="chat_left_time clearfix">'+time +" " + localStorage["name"] +'</div>'+
                '<div class="chat_left_content clearfix">'+str+'</div>'
                +'</div>';
        var oLi=document.createElement("div");
        oLi.setAttribute("class","chat_left");
        oLi.innerHTML=ans;
        send_message.append(oLi);
        message.value="";
    });
</script>

    <script>
        $(document).ready(function() {
            $('#exitBtn').click(function() {
               // location.href = '1.php';
                alert("exit21");
            });
        });
        </script>

<script>
    window.onload = function()
    {
        var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function(){
    if(xhr.readyState == 4 && xhr.status == 200){
      // 处理服务器的响应
     if(xhr.responseText != 6)
     {
        var data=eval("("+xhr.responseText+")");//转换为json对象 
        alert("userName:"+data.userName+",chatDate:"+data.chatDate+",chatRecord:"+data.chatRecord); 
        /*$.each(data,function(idx,item){ 
if(idx==0){ 
return true;//同countinue，返回false同break 
} 
alert("userName:"+item.userName+",chatDate:"+item.chatDate+",chatRecord:"+item.chatRecord); 
}); */
        

		/*for(var i=0; i<data.length; i++)
        {   // 遍历数组读取数据*/
				

        var oLi=document.createElement("div");
        if(localStorage["name"] == data.userName)//本用户的聊天记录输出在右边
        {
            var ans='<div class="chat_right_item_1 clearfix"></div>'+
                '<div class="chat_right_item_2">'+
                    '<div class="chat_right_time clearfix">' + data.userName + " " + data.chatDate +'</div>'+
                    '<div class="chat_right_content clearfix">' + data.chatRecord + '</div>'
                    +'</div>';
            oLi.setAttribute("class","chat_left");
        }
        else//其他用户的聊天记录输出在左边
        {
            var ans='<div class="chat_left_item_1 clearfix"></div>'+
            '<div class="chat_left_item_2">'+
                '<div class="chat_left_time clearfix">' + data.userName + " " + data.chatDate +'</div>'+
                '<div class="chat_left_content clearfix">' + data.chatRecord +'</div>'
                +'</div>';
            oLi.setAttribute("class","chat_rIght");
        }
        oLi.innerHTML=ans;
        send_message.append(oLi);
        message.value="";
    //}
    }
    }
  }
  xhr.open("GET", "func.php?getAction=getChatRecord", true);//XML 名为getAction的GET方法带参数createUserTable
  xhr.send();
    }
    </script>
</body>
</html>
